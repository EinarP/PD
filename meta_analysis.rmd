---
title: "meta"
output:
  word_document: 
    fig_height: 10
    fig_width: 8
    highlight: tango
  html_document:
    fig_height: 8
    fig_width: 10
    highlight: tango
---
Progression of the analysis has a certain structure. This stucture might contain trees, circles, loops, etc. Herein we limit the structure to a simple sequence

## Observations

```{r message=FALSE}
# Load common structural analysis functions
source('atrf.R')

# TODO: Generate data based on analysis object definition?

# Load analysis data from a spreadsheet
suppressWarnings(library(readxl))
anobs <- read_excel('../data/meta_analysis.xlsx')

# Structure of sample data
str(anobs)

# Summary of properties
table(anobs$property)
```

## Context

Something about the context

```{r}
# Initialize the analysis sequence
meta <- analysis('Analysis entity', 'anobs')

# Generate the structure
meta <- grow(meta, 'SEQUENCE', depth=2)
meta <- void(meta, c('EDGE','VERTEX'))

# Polish the output with appropriate seed and partition
meta <- applySeed(sq=meta, seed=163)
meta <- applyPartitioning(meta, 'mbrp')
meta
```

## Detailed view

Something about detailed view

```{r}
# Rearrange the structure
meta <- grow(meta, 'GRAPH', depth=2, attrs=TRUE, vals=TRUE)

# TODO: Workaround till attribute to link conversion done
meta <- void(sq=meta, centers=c("GRAPH>vidx", "GRAPH>eidx"))

# meta <- void(meta, c('REPORT','SEQUENCE','STORAGE'))
meta <- void(meta, c('REPORT','STORAGE'))

# Polish the output with appropriate seed 
meta <- applySeed(sq=meta, seed=225)
meta

# meta <- applyAlternation(meta)
#meta
```

## Analysis object final view [CKPT=Final]

To illustrate the timeline

```{r}

#meta <- voidCenter(meta, c('REPORT','STORAGE'))

```

## Analysis object demos

```{r}
#meta <- applyTheme(meta, 'minimalist')
#meta

void(meta, c('OBSERVATION','SEQUENCE'))

# Grouping demo
gmeta <- applySeed(meta, 297)
gmbr <- c('GRAPH>seed', 'GRAPH>theme', 'GRAPH>layout')
gmeta <- group(gmeta, 'GRAPH>mandatory', gmbr)

gmbr <- c('GRAPH>partitioning', 'GRAPH>alternation', 'GRAPH>vsizing', 'GRAPH>esizing', 'GRAPH>simplicity')
gmeta <- group(gmeta, 'GRAPH>optional', gmbr)

gmbr <- c('GRAPH>scaling', 'GRAPH>symmetry', 'GRAPH>gradient')
gname <- 'GRAPH>polishing'
gmeta <- group(gmeta, gname, gmbr)
gmeta

smeta <- applySeed(meta, 678)
smeta <- doScaling(sq=smeta, scaling=3)
smeta

# Add relevant details
sizobj <- applySeed(meta, 166)
sizobj <- applySizing(sizobj, method='wt')
sizobj

# Highlighting demo
hlobj <- applySeed(meta, 473)
hlobj <- applyHighlight(hlobj, c('GRAPH','SEQUENCE'))
hlobj

applyLayout(sq=meta, layout="layout_on_grid")

# Finalise the sequence
# signoff(meta)
```

# Dynamics
```{r}
library(ggplot2)

set.seed(3)

n <- 9
steps <- 1:n

asm <- unlist(lapply(steps, function(x) {
  rep(x, x + 1 + abs(rnorm(1, 0, 2)))
}))
df <- data.frame(cbind(type=rep('assembly', length(asm)), count=asm))

dif <- unlist(lapply(steps, function(x) {
  rep(x,  n * (n - x+ abs(rnorm(1, 0, 2))))
}))
df <- rbind(df, cbind(type=rep('differentiation', length(dif)), count=dif))

p <- ggplot(df, aes(x=count, fill=type))
p <- p + stat_count(width=0.5, position='dodge')
p <- p + theme(legend.position=c(1,1), legend.justification=c(1.1,1))
p <- p + labs(x='Steps', y='Number of Centers')
p <- p + geom_vline(aes(xintercept=0.5), color='darkblue', linetype='dotted', size=1)
p <- p + geom_text(aes(x=0.5, label='baseline', y=100), hjust = -0.1, color='darkblue')
p <- p + geom_vline(aes(xintercept=3.5), color='darkblue', linetype='dotted', size=1)
p <- p + geom_text(aes(x=3.5, label='checkpoint 1', y=100), hjust = -0.1, color='darkblue')
p <- p + geom_vline(aes(xintercept=5.5, label='ckpt2'), color='darkblue', linetype='dotted', size=1)
p <- p + geom_text(aes(x=5.5, label='checkpoint 2', y=100), hjust = -0.1, color='darkblue')
p
```

